# 004 - データベースアクセスライブラリにSQLxを採用する

## Status

Accepted

## Context

本プロジェクトにおいて，PostgreSQLを主要なRDBMSとして採用するにあたり，Rustからのデータベースアクセスを担うライブラリの選定が必要である。

Rustでは複数の選択肢が存在し，それぞれ特徴が大きく異なる。プロジェクトの方向性（非同期処理，型安全性，マイグレーション管理，メンテナンス性など）を踏まえ，最適な選定を行う。

## Considerations

検討対象：

- SQLx：非同期対応・マクロなし・コンパイル時SQL検証
- Diesel：同期・マクロ多用・マイグレーション機能が強力
- SeaORM：Active Record型のORM
- tokio-postgres：非同期低レベルクライアント

比較観点：

- 非同期対応
- SQLの記述方法
- 型安全性
- マイグレーション管理
- Rustとの親和性
- 運用実績

## Decision

SQLxを採用する。

採用理由：

1. 非同期接続に対応している。
2. SQLをそのままコーディングする形式のため，学習コストが低い。
3. SQLの構文チェックや型チェックが機能に含まれるため，実行時エラーが起こりづらい。

## Consequences

1. SQL文は正確に記述しなければならない。
2. マイグレーションツールを利用してマイグレーションをファイル管理できる。
3. Dieselのような抽象的なDSLは利用できないため，クエリの最適化や複雑なSQLは自身で制御する必要がある。

## Notes

Owner: nostalgic.5pm
Proposed date: 2025-06-01
Last updated: 2025-06-01
